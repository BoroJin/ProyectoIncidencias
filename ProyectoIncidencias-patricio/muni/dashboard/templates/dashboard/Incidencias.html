{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{% static 'dashboard/css/style_incidencias.css' %}"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <title>incidencias</title>
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <img
          src="https://cdn-icons-png.flaticon.com/512/2228/2228497.png"
          alt="Logo Municipalidad"
        />
        <a href="#">Municipalidad</a>
      </div>
      <div class="user">
        <img
          src="https://icons.veryicon.com/png/o/miscellaneous/icon-the-back-office-management-system/administrator-role-management.png"
          class="user-pic"
          alt="Usuario"
        />
      </div>
    </header>
    <main class="main-container">
      <aside class="sidebar">
        <ul>
          <li>
            <a href="{% url 'dashboard' %}">Dashboard</a>
            <a href="{% url 'incidencias' %}">Incidencias</a>
            <a href="{% url 'formulario' %}">formulario</a>
          </li>
        </ul>
      </aside>
      <section class="content">
        {% if messages %}
        <div class="alert alert-success" role="alert">
          {% for message in messages %}
            {{ message }}
          {% endfor %}
        </div>
        {% endif %}
        <div class="container-box">
          <div class="table-responsive">

            <h2>Incidencias</h2>
            <table class="table">
              <thead>
                <tr>
                  {% for columna in columnas1 %}
                  <th>{{ columna }}</th>
                  <!-- Muestra el nombre de la columna -->
                  {% endfor %}
                  <th>opciones</th>
                </tr>    
              </thead>
            </thead>
            <tbody>
              {% for fila in datos_incidencias %}
              <tr>
                {% for dato in fila %}
                  <td>{{ dato }}</td>
                {% endfor %}
                <td>
                  <!-- Botón de Rechazar que muestra el formulario de justificación -->
                  <a href="#" class="btn btn-danger btn-sm" data-toggle="collapse" data-target="#formularioRechazo{{ fila.0 }}">Rechazar</a>
                </td>
              </tr>
              <tr id="formularioRechazo{{ fila.0 }}" class="collapse">
                <td colspan="5">
                  <!-- Formulario de Justificación -->
                  <form method="post" action="{% url 'rechazar_incidencia' fila.0 %}">
                    {% csrf_token %}
                    <textarea name="justificacion_rechazo" rows="3" cols="50" placeholder="Escribe la justificación aquí..." required></textarea>
                    <br>
                    <button type="submit" class="btn btn-danger btn-sm">Confirmar Rechazo</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
  </body>
</html>
